<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的购物车-小米商城</title>
    <link rel="icon" href="../images/til.ico" type="image/x-icon">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/cart.css">
    <link rel="stylesheet" href="../fonts/iconfont.css">
    <link rel="stylesheet" href="../jquery-pagination/pagination.css">
</head>

<body>
    <!-- header -->
    <div class="heads_cart">
        <div class="heads_cart_con">
            <div class="nav_les flex_clear">
                <a href="./index.html">
                    <ol>

                        <li>
                            <img src="https://s02.mifile.cn/assets/static/image/mi-home.png" alt="">
                        </li>
                        <li>
                            <img src="https://s02.mifile.cn/assets/static/image/mi-logo.png" alt="">
                        </li>
                    </ol>
                </a>
                <h2>我的购物车</h2>
                <p>温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算
                </p>
            </div>
            <ul>
                <li>
                    <a href="" class="heads_login">
                        <i>2670098661</i>
                        <span class="iconfont icon-jiantou9"></span>
                    </a>
                    <ul class="bot_list_log">
                        <li>
                            <a href="">
                              个人中心
                            </a>
                        </li>
                        <li>
                            <a href="">
                            评价晒单
                            </a>
                        </li>
                        <li>
                            <a href="">
                             我的喜欢
                            </a>
                        </li>
                        <li>
                            <a href="">
                            小米账户
                            </a>
                        </li>
                        <li>
                            <a href="">
                            退出登录
                            </a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="">我的订单</a>
                </li>
            </ul>

        </div>
    </div>
    <!-- shoppCart -->
    <div class="shoppCart">
        <div class="shoppCart_con">
            <ul class="shopp_title">
                <li class="shop_select">
                    <span>选择<span class="iconfont icon-jiantou9"></span></span>
                    <div class="shop_select_list">
                        <div><input class="yesCH" type="checkbox"><span>全选</span></div>
                        <div><input class="noCH" type="checkbox"><span>不选</span></div>
                        <div><input class="nyCH" type="checkbox"><span>反选</span></div>
                    </div>

                </li>
                <li>商品名称</li>
                <li>单价</li>
                <li>数量</li>
                <li>小计</li>
                <li>操作</li>
            </ul>
            <div></div>


        </div>
        <div class="shop_buy"></div>
    </div>
    <!-- footer -->
    <div class="footer_con">
        <ul class="foot_top">
            <li>
                <a href="">
                    <span class="iconfont icon-icongongju"></span>
                    <span>预约维修服务</span>
                </a>
            </li>
            <li>
                <a href="">
                    <span class="iconfont icon-7tianwuliyoutuihuo"></span>
                    <span>7天无理由退货</span>
                </a>
            </li>
            <li>
                <a href="">
                    <span class="iconfont icon-15tianwuliyoutuihuo"></span>
                    <span>15天免费换货</span>
                </a>
            </li>
            <li>
                <a href="">
                    <span class="iconfont icon-lipin"></span>
                    <span>满99元包邮</span>
                </a>
            </li>
            <li>
                <a href="">
                    <span class="iconfont icon-dingwei"></span>
                    <span>520余家售后网点</span>
                </a>
            </li>
        </ul>
        <div class="foot_tops flex_clear">
            <dl>
                <dt>帮助中心</dt>
                <dd>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                </dd>
            </dl>
            <dl>
                <dt>帮助中心</dt>
                <dd>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                </dd>
            </dl>
            <dl>
                <dt>帮助中心</dt>
                <dd>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                </dd>
            </dl>
            <dl>
                <dt>帮助中心</dt>
                <dd>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                </dd>
            </dl>
            <dl>
                <dt>帮助中心</dt>
                <dd>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                </dd>
            </dl>
            <dl>
                <dt>帮助中心</dt>
                <dd>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                    <a href="">
                        账户管理
                    </a>
                </dd>
            </dl>
            <dl>
                <dt>400-100-5657</dt>
                <dd>
                    <h4>8:00-18:00(仅收取话费)</h4>
                    <div>
                        <span class="iconfont icon-tongdao">人工客服</span>
                    </div>
                    <div class="flex_clear">
                        <span>关注小米:</span>
                        <a href="" style="padding: 3px 5px 0 5px;"><span class="iconfont icon-qq"></span></a>
                        <a href="" style="padding: 3px 0px 0 0px;"><span class=" iconfont icon-weixin "></span></a>
                    </div>
                </dd>
            </dl>
        </div>
        <div class="footer_bottoms ">
            <ul class="flex_clear ">

            </ul>
            <ul class="flex_clear ">
            </ul>
            <ul class="flex_clear ">
                <li>
                    <a href=" "><img src="http://i1.mifile.cn/f/i/17/site/truste.png " alt=" "></a>
                </li>
                <li>
                    <a href=" "><img src="http://s01.mifile.cn/i/v-logo-2.png " alt=" "></a>
                </li>
                <li>
                    <a href=" "><img src="http://s01.mifile.cn/i/v-logo-1.png " alt=" "></a>
                </li>
            </ul>
        </div>
    </div>
    <script src="../js/tools.js"></script>
    <script src="../js/jquery.min.js"></script>
    <script src="../jquery-pagination/jquery.pagination.js"></script>
    <!-- 页面布局 -->
    <script src="../js/pageBot.js"></script>
    <!-- 页面逻辑 -->
    <script>
        const dataList = JSON.parse(localStorage.getItem('cart'));
        const shopFather = document.querySelector('.shoppCart_con>div');
        const buyPanel = document.querySelector('.shop_buy');
        const selectShop = document.querySelector(".shop_select_list");

        setShopView();
        setFootShop();
        // 页面布局
        function setShopView() {
            let str_shop = '';
            dataList.forEach((datas, k) => {

                str_shop += `<ul  class="shop_cont">
                <li>
                    <input class="checkBuy" index=${k} type="checkbox" ${datas.buy?"checked":""} >
                    <div>
                        <img src="${datas.goods_small_logo}" alt="">
                    </div>
                    <p>${datas.goods_name}</p>
                    <span>${datas.goods_price}元</span>
                    <div>
                        <input type="submit" index=${k} class="clearBuy" value="-">
                        <input class="shop_num" type="text" placeholder="${datas.num}">
                        <input type="submit" index=${k} class="addBuy" value="+">
                    </div>
                    <span>${(datas.goods_price*datas.num).toFixed(2)}元</span>
                    <span class="closeGoods" index=${k} >X</span>
                </li>
            </ul>`;

            });
            shopFather.innerHTML = str_shop;
        }
        // 选择按钮逻辑
        selectShop.addEventListener("click", function(e) {
            e = e || window.event;
            if (e.target.className == 'yesCH') {
                $(".checkBuy").prop("checked", true);
                dataList.forEach((v, k) => {
                    dataList[k].buy = true;
                });
                $(".shop_select_list div:nth-of-type(2)>input").prop("checked", false)
                $(".shop_select_list div:nth-of-type(3)>input").prop("checked", false)
            } else if (e.target.className == 'noCH') {
                dataList.forEach((v, k) => {
                    dataList[k].buy = false;
                });
                // console.log(dataList[1].buy);
                $(".checkBuy").prop("checked", false);
                $(".shop_select_list div:nth-of-type(1)>input").prop("checked", false)
                $(".shop_select_list div:nth-of-type(3)>input").prop("checked", false)
            } else if (e.target.className == 'nyCH') {
                $('.checkBuy').each((key, item) => {
                    dataList[key].buy = !$(item).prop("checked");
                    $(item).prop("checked", !$(item).prop("checked"));
                    $(".shop_select_list div:nth-of-type(2)>input").prop("checked", false)
                    $(".shop_select_list div:nth-of-type(1)>input").prop("checked", false)
                })

            }
            localStorage.setItem("cart", JSON.stringify(dataList));
            setFootShop()
        })
        const shopPanel = document.querySelectorAll(".shop_cont");

        // 加减删除逻辑
        $(shopFather).click(function(e) {

            e = e || window.event;
            if (e.target.tagName == "INPUT") {
                if (e.preventDefault) {
                    e.preventDefault();
                } else {
                    e.returnValue = true;
                }
            }
            if (e.target.className == "addBuy") {
                let n = e.target.getAttribute("index")
                if (dataList[n].num < dataList[n].goods_number) {
                    dataList[n].num += 1;
                } else {
                    window.confirm("库存不足，客观只有这些啦！！")
                    dataList[n].num = dataList[n].goods_number

                }
            } else if (e.target.className == "clearBuy") {
                let n = e.target.getAttribute("index")
                console.log(dataList[n].num)
                if (dataList[n].num > 1) {
                    dataList[n].num -= 1;
                } else {
                    let bool = window.confirm("您确定要移出此商品吗？");
                    if (bool) {
                        dataList.splice(n, 1);
                    }
                }
            } else if (e.target.className == "closeGoods") {
                let n = e.target.getAttribute("index")
                dataList.splice(n, 1);
            } else if (e.target.className == "checkBuy") {
                let num = e.target.getAttribute("index");
                dataList[num].buy = !dataList[num].buy;
            }
            localStorage.setItem("cart", JSON.stringify(dataList));
            setShopView();
            setFootShop();
        })

        function setFootShop() {
            let numBuy = 0;
            let moneys = 0;
            let nums = 0;
            $(".shop_select_list div>input").click(
                function() {
                    console.log("11")
                }
            )
            $('.checkBuy').each((key, item) => {
                if ($(item).prop("checked")) {
                    let datas = dataList[key]
                    numBuy += datas.num;
                    moneys += parseFloat((datas.goods_price * datas.num).toFixed(2));
                }
                nums += dataList[key].num;
            })
            str = `
           
            <p>继续购买 共<span>${nums}</span> 件商品，已选<span>${numBuy}</span> 件</p>
            <p>共计：<span>${moneys}</span>元</p>
            <button class="${numBuy<=0?"buyList":''}">去结算</button>
            <div   class="${numBuy>0?"buyListShow":''}">
                请勾选需要结算的商品
                <span></span>
            </div>`;
            buyPanel.innerHTML = str;
        }
    </script>
</body>

</html>